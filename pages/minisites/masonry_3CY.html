{{"extend": "minisites/index.html"}}
{$latestexhibitions = $scope.latest}
{$years = $scope.exhibition_years}

{block name=title}
	<h2 class="page_title">{$minisite_pageObj.page_title}</h2>
{/block}  

{block name=content} 
<style>
	.item-container{
		margin:0px auto;
	}
	.item-grid {
		display: block;
		padding:0px 15px;
	    float: left;
		overflow: hidden;
		z-index: 1;
	}
	.item-grid-contnt{
		
	}
	.item-grid h3 {
		color: #000;
	}
	.item-grid p {
		color: #5b5b5b;
	}
	.item-grid img {
		width: 100%;
		height: auto;
		display: block;
	}
	.item-grid-sizer, .item-grid {
		width: 32%;
	}
	@media screen and (max-width: 750px) {
		.item-grid-sizer, .item-grid {
			width: 46%;
		}
	}
	@media screen and (max-width: 500px) {
		.item-grid-sizer, .item-grid {
			width: 100%;
		}
	}
</style>
{$data = json_decode($minisite_pageObj.data, TRUE)}
{if ($data.show_current)} {$current = 'current'} {/if}
{if ($data.show_past)} {$past = 'past'} {/if}
{if ($data.show_future)} {$future = 'future'} {/if}
{$index = 0} {$count = 0}

{foreach from=$years item=year}
	<h1 class="year_{$year['year']}" style="display: none;">{$year['year']}</h1> <br>
	<div class="item-container">
		<div class="item-grid-sizer"></div>
		<div class="item-gutter-sizer"></div>		
		{foreach from=$exhibitions item=exhibition}
			{if (($exhibition.current == $future) || ($exhibition.current == $current) || ($exhibition.current == $past))}
				{if ($year['year'] == array_shift(explode('-', $exhibition.start_date)) )}
					{$yearExist[] = $year['year']}
					<div class="item-grid">
						 <figure id="{$exhibition.id}" data-sharer_id="{$scope.user_id}" data-index="{$index}" class="__vp-plugin-container vp-loader-photoswipe">         
							<div class="__vp-flip-container" ontouchstart="this.classList.toggle('hover');">       
							  <div class="__vp-flipper">             
								<div class="__vp-flip-front">               
								  <img class="__vp-plugin-image center-cropped" src="{$exhibition|collection_photo:'medium'}"  alt="{$exhibition.name}">             
								</div>             
								<div class="__vp-flip-back __vp-plugin-hover">               
								  <img class="__vp-flip-back-image" src="{$exhibition|collection_photo:'small'}" alt="{$exhibition.name}">               
								  <div class="__vp-flip-back-card"> 
									<a href="{$basepath}/{$exhibition.page_slug}/{$exhibition.slug}">             
									  <h2>{$exhibition.title}</h2>   
									  <div class="mt10">{$exhibition|artists}</div> 
									  <div>{$exhibition.start_date|date_format:"%e %b %Y"} - {$exhibition.end_date|date_format:"%e %b %Y"}</div>    
									</a>               
								  </div>                                                                
								</div>           
							  </div>         
							</div> 
							{{"include": "minisites/exh_details.html"}}       
						</figure>
					</div>
				{/if}
				{$count = 1} {$index = $index + 1}
			{/if}
		{/foreach}
	</div><br>
{/foreach}

{if (($data.show_latest) && (!$count))}
	<div class="item-container">
		<div class="item-grid-sizer"></div>
		<div class="item-gutter-sizer"></div>
		{foreach from=$latestexhibitions item=exhibition}
		<div class="item-grid">
			 <figure id="{$exhibition.id}" data-sharer_id="{$scope.user_id}" data-index="{$index}" class="__vp-plugin-container vp-loader-photoswipe">         
				<div class="__vp-flip-container" ontouchstart="this.classList.toggle('hover');">           
				  <div class="__vp-flipper">             
					<div class="__vp-flip-front">               
					  <img class="__vp-plugin-image center-cropped" src="{$exhibition|collection_photo:'medium'}"  alt="{$exhibition.name}">             
					</div>             
					<div class="__vp-flip-back __vp-plugin-hover">               
					  <img class="__vp-flip-back-image" src="{$exhibition|collection_photo:'small'}" alt="{$exhibition.name}">               
					  <div class="__vp-flip-back-card"> 
						<a href="{$basepath}/{$exhibition.page_slug}/{$exhibition.slug}">                
						  <h2>{$exhibition.title}</h2>   
						  <div class="mt10">{$exhibition|artists}</div> 
						  <div>{$exhibition.start_date|date_format:"%e %b %Y"} - {$exhibition.end_date|date_format:"%e %b %Y"}</div>    
						</a>               
					  </div>                                                                
					</div>           
				  </div>         
				</div> 
				{{"include": "minisites/exh_details.html"}}       
			</figure>
		</div>
		{/foreach}
	</div>
{/if}

<script src='https://cdnjs.cloudflare.com/ajax/libs/masonry/3.3.2/masonry.pkgd.min.js'></script>
<script>
	$(document).ready(function(){
	  var yearExist = "{$yearExist|json_encode}";
	  console.log("Existing Year "+JSON.stringify(yearExist) );
	  var data = jQuery.parseJSON(yearExist);
	  $.each(data, function(index, value) {
	    $('.year_'+value).show();
	  });

	    $('.item-container').masonry({
	  	columnWidth : '.item-grid-sizer',
	  	gutter : 15,
	  	itemSelector : '.item-grid',
	  	percentPosition : 'true',
	  	fitWidth: true,
	    });
	});

</script>
{/block}